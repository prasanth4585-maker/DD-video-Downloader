<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Universal Downloader</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}

body{
    min-height:100vh;
    background:radial-gradient(circle at top,#0f2027,#000);
    display:flex;
    align-items:center;
    justify-content:center;
    color:#fff;
    padding:15px;
}

.card{
    width:100%;
    max-width:560px;
    padding:25px;
    border-radius:22px;
    background:rgba(255,255,255,0.08);
    backdrop-filter:blur(15px);
    box-shadow:0 30px 60px rgba(0,0,0,.6);
}

h1{text-align:center;font-weight:600}
.tagline{text-align:center;font-size:14px;opacity:.8;margin:10px 0 20px}

/* URL TAB */
.url-tab{
    background:linear-gradient(135deg,#00c6ff,#0072ff);
    padding:10px;
    border-radius:14px;
}
.url-tab input{
    width:100%;
    padding:14px;
    border:none;
    border-radius:10px;
    outline:none;
    font-size:15px;
}

/* SELECTS */
.row{
    display:flex;
    gap:10px;
    margin:15px 0;
}
select{
    flex:1;
    padding:12px;
    border-radius:10px;
    border:none;
    outline:none;
}

/* BUTTON */
button{
    width:100%;
    padding:14px;
    border:none;
    border-radius:14px;
    background:linear-gradient(135deg,#00ffcc,#00c6ff);
    color:#000;
    font-size:16px;
    font-weight:600;
    cursor:pointer;
    transition:transform 0.2s;
}
button:hover{
    transform:scale(1.02);
}
button:disabled{
    opacity:0.6;
    cursor:not-allowed;
}

/* INFO */
.info{
    font-size:13px;
    opacity:.8;
    margin-top:10px;
    text-align:center;
}

.video-info{
    background:rgba(0,255,204,0.1);
    border-radius:12px;
    padding:12px;
    margin:15px 0;
    text-align:center;
}
.video-info img{
    width:100%;
    max-height:180px;
    object-fit:cover;
    border-radius:8px;
    margin-bottom:8px;
}
.video-title{
    font-size:14px;
    font-weight:600;
    margin-bottom:4px;
}
.video-duration{
    font-size:12px;
    opacity:0.8;
}

/* NEON DD CREATION */
.neon{
    margin-top:25px;
    text-align:center;
    font-size:16px;
    font-weight:600;
    color:#00ffcc;
    text-shadow:
        0 0 5px #00ffcc,
        0 0 10px #00ffcc,
        0 0 20px #00c6ff,
        0 0 40px #0072ff;
    animation:glow 2s infinite alternate;
}

@keyframes glow{
    from{opacity:.6}
    to{opacity:1}
}

.loading{
    text-align:center;
    padding:10px;
    color:#00ffcc;
}

/* MOBILE */
@media(max-width:480px){
    .row{flex-direction:column}
}
</style>
</head>
<body>

<div class="card">
    <h1>Universal Downloader</h1>
    <div class="tagline">Download Video ‚Ä¢ MP3 ‚Ä¢ Images</div>

    <div class="url-tab">
        <input id="url" placeholder="Paste social media link here">
    </div>

    <div id="videoInfoContainer"></div>

    <div class="row">
        <select id="mediaType" onchange="updateFormats()">
            <option value="video">üé¨ Video</option>
            <option value="audio">üéµ MP3</option>
            <option value="image">üñºÔ∏è Image</option>
        </select>

        <select id="format"></select>
    </div>

    <button onclick="startDownload()" id="downloadBtn">Download</button>

    <div class="info" id="infoText">
        Paste a URL to see video info and file sizes
    </div>

    <div class="neon">‚ö° DD Creation ‚ö°</div>
</div>

<script>
const formatSelect = document.getElementById("format");
const infoText = document.getElementById("infoText");
const videoInfoContainer = document.getElementById("videoInfoContainer");
const downloadBtn = document.getElementById("downloadBtn");

let videoData = null;

// Bitrate constants (MB per minute)
const bitrates = {
    video: {
        "4K": 25,
        "1080p": 8,
        "720p": 4,
        "480p": 2,
        "360p": 1,
        "WEBM": 3,
        "MKV": 7
    },
    audio: {
        "320": 2.5,
        "192": 1.5,
        "128": 1,
        "AAC": 1.2,
        "WAV": 10,
        "FLAC": 6
    }
};

function extractVideoId(url) {
    const patterns = [
        /(?:youtube\.com\/watch\?v=|youtu\.be\/)([^&\n?#]+)/,
        /youtube\.com\/embed\/([^&\n?#]+)/,
        /youtube\.com\/shorts\/([^&\n?#]+)/
    ];
    
    for (const pattern of patterns) {
        const match = url.match(pattern);
        if (match) return match[1];
    }
    return null;
}

function calculateFileSize(type, quality, duration) {
    if (!duration) duration = 3; // default 3 minutes
    
    let bitrate = 1;
    
    if (type === 'video') {
        bitrate = bitrates.video[quality] || 4;
    } else if (type === 'audio') {
        bitrate = bitrates.audio[quality] || 1;
    } else if (type === 'image') {
        return quality === 'all' ? 10 : 2; // Fixed size for images
    }
    
    return (bitrate * duration).toFixed(1);
}

// Listen for URL input changes
document.getElementById('url').addEventListener('blur', fetchVideoInfo);
document.getElementById('url').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        fetchVideoInfo();
    }
});

async function fetchVideoInfo() {
    const url = document.getElementById('url').value.trim();
    if (!url) return;

    const videoId = extractVideoId(url);
    if (!videoId) {
        infoText.innerHTML = '‚ö†Ô∏è Invalid URL. Please use YouTube, Instagram, TikTok, Facebook, or Twitter';
        return;
    }

    videoInfoContainer.innerHTML = '<div class="loading">‚è≥ Loading video info...</div>';

    // Fetch video data (using YouTube oEmbed API)
    try {
        const response = await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${videoId}&format=json`);
        const data = await response.json();
        
        // Estimate duration (since oEmbed doesn't provide it, we'll use a default or fetch from thumbnail)
        const duration = 5; // Default 5 minutes (you can enhance this with YouTube Data API)
        
        videoData = {
            id: videoId,
            title: data.title || 'Video',
            thumbnail: `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`,
            duration: duration,
            author: data.author_name || 'Unknown'
        };

        displayVideoInfo(videoData);
        updateFormats();
    } catch (error) {
        // If oEmbed fails, use basic info
        videoData = {
            id: videoId,
            title: 'Video',
            thumbnail: `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`,
            duration: 5,
            author: 'Unknown'
        };
        displayVideoInfo(videoData);
        updateFormats();
    }
}

function displayVideoInfo(data) {
    videoInfoContainer.innerHTML = `
        <div class="video-info">
            <img src="${data.thumbnail}" alt="thumbnail" onerror="this.style.display='none'">
            <div class="video-title">${data.title}</div>
            <div class="video-duration">Duration: ~${data.duration} min ‚Ä¢ By ${data.author}</div>
        </div>
    `;
    infoText.innerHTML = `‚úÖ Video detected! Select format to see file size`;
}

function updateFormats() {
    const type = document.getElementById("mediaType").value;
    formatSelect.innerHTML = "";

    let formats = [];
    let info = "";
    const duration = videoData ? videoData.duration : 3;

    if(type === "video"){
        formats = [
            { label: "MP4 - 4K", quality: "4K", size: calculateFileSize('video', '4K', duration) },
            { label: "MP4 - 1080p", quality: "1080p", size: calculateFileSize('video', '1080p', duration) },
            { label: "MP4 - 720p", quality: "720p", size: calculateFileSize('video', '720p', duration) },
            { label: "MP4 - 480p", quality: "480p", size: calculateFileSize('video', '480p', duration) },
            { label: "MP4 - 360p", quality: "360p", size: calculateFileSize('video', '360p', duration) },
            { label: "WEBM", quality: "WEBM", size: calculateFileSize('video', 'WEBM', duration) },
            { label: "MKV", quality: "MKV", size: calculateFileSize('video', 'MKV', duration) },
            { label: "Convert to MP3", quality: "320", size: calculateFileSize('audio', '320', duration) }
        ];
        info = "File sizes based on video duration";
    }
    else if(type === "audio"){
        formats = [
            { label: "MP3 - 320 kbps", quality: "320", size: calculateFileSize('audio', '320', duration) },
            { label: "MP3 - 192 kbps", quality: "192", size: calculateFileSize('audio', '192', duration) },
            { label: "MP3 - 128 kbps", quality: "128", size: calculateFileSize('audio', '128', duration) },
            { label: "AAC", quality: "AAC", size: calculateFileSize('audio', 'AAC', duration) },
            { label: "WAV", quality: "WAV", size: calculateFileSize('audio', 'WAV', duration) },
            { label: "FLAC", quality: "FLAC", size: calculateFileSize('audio', 'FLAC', duration) }
        ];
        info = "High quality audio with dynamic sizing";
    }
    else if(type === "image"){
        formats = [
            { label: "JPG", quality: "jpg", size: "2" },
            { label: "PNG", quality: "png", size: "3" },
            { label: "WEBP", quality: "webp", size: "1.5" },
            { label: "Download All Images", quality: "all", size: "10" }
        ];
        info = "Download images in multiple formats";
    }

    if (videoData) {
        infoText.innerText = info;
    }

    formats.forEach(f => {
        const opt = document.createElement("option");
        opt.textContent = `${f.label} (~${f.size} MB)`;
        opt.value = JSON.stringify(f);
        formatSelect.appendChild(opt);
    });
}

// Load formats initially
updateFormats();

async function startDownload() {
    const url = document.getElementById("url").value.trim();
    if(!url){
        alert("‚ö†Ô∏è Kindly insert the URL\n\nPlease paste a video link in the input field above.");
        document.getElementById("url").focus();
        return;
    }

    if (!videoData) {
        infoText.innerHTML = '‚è≥ Fetching video info... Please wait';
        await fetchVideoInfo();
        if (!videoData) {
            alert("‚ö†Ô∏è Could not load video info\n\nPlease check your URL and try again.");
            return;
        }
    }

    const selectedFormat = JSON.parse(formatSelect.value);
    const mediaType = document.getElementById("mediaType").value;

    downloadBtn.disabled = true;
    downloadBtn.textContent = "Processing...";

    // Simulate download process
    setTimeout(() => {
        // For images, try to download thumbnail
        if (mediaType === 'image') {
            downloadImage(videoData.thumbnail, `thumbnail.${selectedFormat.quality}`);
        } else {
            alert(`‚úÖ Download Ready!\n\nVideo: ${videoData.title}\nDuration: ~${videoData.duration} min\nFormat: ${selectedFormat.label}\nFile Size: ~${selectedFormat.size} MB\n\n‚ö†Ô∏è Backend Required:\nFor actual video/audio downloads, integrate with:\n- yt-dlp API\n- youtube-dl\n- Third-party download services\n\nImage downloads work now!`);
        }
        
        downloadBtn.disabled = false;
        downloadBtn.textContent = "Download";
    }, 1000);
}

function downloadImage(url, filename) {
    fetch(url)
        .then(response => response.blob())
        .then(blob => {
            const blobUrl = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = blobUrl;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(blobUrl);
            alert('‚úÖ Image downloaded successfully!');
        })
        .catch(() => {
            alert('‚ö†Ô∏è Image download failed. Try another format.');
        });
}
</script>

</body>
</html>